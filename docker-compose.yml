services:
  gotenberg:
    image: gotenberg/gotenberg:8
    container_name: bg-pdf-service
    command:
      - "gotenberg"
      - "--api-port=3000"
      - "--api-enable-basic-auth"
      - "--api-timeout=${API_TIMEOUT:-120s}"
      - "--chromium-auto-start=${CHROMIUM_AUTO_START:-true}"
      - "--chromium-restart-after=${CHROMIUM_RESTART_AFTER:-50}"
      - "--chromium-max-queue-size=20"
      - "--chromium-disable-javascript=true"
      - "--chromium-clear-cache=true"
      - "--chromium-clear-cookies=true"
      - "--api-disable-download-from=true"
      - "--webhook-disable=true"
      - "--log-level=${LOG_LEVEL:-info}"
      - "--log-format=json"
    ports:
      - "127.0.0.1:${GOTENBERG_PORT:-3001}:3000"
    environment:
      - GOTENBERG_API_BASIC_AUTH_USERNAME=${GOTENBERG_API_BASIC_AUTH_USERNAME:-}
      - GOTENBERG_API_BASIC_AUTH_PASSWORD=${GOTENBERG_API_BASIC_AUTH_PASSWORD:-}
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test: ["CMD", "curl", "-sf", "-u", "${GOTENBERG_API_BASIC_AUTH_USERNAME}:${GOTENBERG_API_BASIC_AUTH_PASSWORD}", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
        reservations:
          memory: 512M
          cpus: '0.5'
    tmpfs:
      - /tmp:size=512M
